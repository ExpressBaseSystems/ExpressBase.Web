@{
    var bApnd = true;
    if (ViewBag.Env == "Development")
    {
        bApnd = false;
    }
}

@using ExpressBase.Objects;

<script>
    console.log(Date.now);
    var t0 = performance.now();
</script>


<link href="~/css/Bootstrap_JQuery/jquery-ui-1.12.1.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="~/css/Bootstrap_JQuery/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick-theme.css" />
@*BUNDLES*@
<environment exclude="Development">
    <link rel="stylesheet" href="~/css/Bundles/eb-botpage.bundle.css" asp-append-version=@bApnd />
</environment>
<link rel="stylesheet" type="text/css" href="~/css/EbChatBot.css" asp-append-version=@bApnd />


<environment include="Development">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap">
    @*<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick-theme.css" />*@
    <link rel="stylesheet" type="text/css" href="~/css/jquery.datetimepicker.css" asp-append-version=@bApnd>
    <link rel="stylesheet" type="text/css" href="~/css/bootstrap-select.min.css" asp-append-version=@bApnd />
    @*roby*@
    <link rel="stylesheet" type="text/css" href="~/css/Common/offline-theme-dark.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="~/css/datatables.min.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick.css" />
    <link href="https://rawgit.com/KidSysco/jquery-ui-month-picker/v3.0.0/demo/MonthPicker.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">

    <link rel="stylesheet" type="text/css" href="~/css/Eb.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/EbControls/EbCardSet.css" asp-append-version=@bApnd />
    <link rel="stylesheet" href="~/css/yearpicker.css">
    <link rel="stylesheet" type="text/css" href="~/css/Eb_datatable.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/FormBuiderStyles.css" asp-append-version=@bApnd />
    @*<link rel="stylesheet" type="text/css" href="~/css/EbChatBot.css" asp-append-version=@bApnd />*@
    <link rel="stylesheet" type="text/css" href="~/css/EbCommonStyles/eb-style.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/DVBuilder.css" />
    <link rel="stylesheet" href="~/css/ChartStyle.css" asp-append-version=@bApnd>
    <link rel="stylesheet" type="text/css" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css">
    <link rel="stylesheet" type="text/css" href="~/css/EbFileViewer/viewer.css" asp-append-version=@bApnd>
    <link rel="stylesheet" href="~/css/MeetingPicker.css">
</environment>

@*<link rel="stylesheet" href="/resources/demos/style.css">*@

@*******************************JAVASCRIPT*****************************@

<script type="text/javascript" src="~/js/Bundles/bootsrap_jq.bundle.min.js" asp-append-version=@bApnd></script>

@*BUNDLES*@
<environment exclude="Development">
    <script type="text/javascript" src="~/js/Bundles/eb-botpage.bundle.js" asp-append-version=@bApnd></script>
</environment>

<environment include="Development">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script type="text/javascript" src="~/js/jquery.datetimepicker.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbDataTable.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/vue-select.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/Eb_UtilityFuncions.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="https://unpkg.com/vue@2.1.10"></script>
    <script type="text/javascript" src="~/js/Eb_select.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/FormBuilder/InitFormControls.js" asp-append-version=@bApnd></script>

    @*amal*@
    <script type="text/javascript" src="~/js/EbServerEvents/eventsource.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbServerEvents/ss-utils.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbServerEvents/ServerEvents.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/Common/offline.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/eb_common.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-confirmation/1.0.7/bootstrap-confirmation.min.js"></script>
    <script type="text/javascript" src="~/js/ChatBot/Eb_chatBot.js" asp-append-version=@bApnd></script>

    @*jith*@
    <script type="text/javascript" src="~/js/Eb_Basic_DataTable.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/FormBuilder/EbSurveyRender.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/jQuery Mask Plugin v1.14.9.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick.min.js"></script>
    <script type="text/javascript" src="~/js/datatables.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-locationpicker/0.1.12/locationpicker.jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.3/Chart.js"></script>

    <script src="~/js/EbControls/EbProgressBar.js" type="text/javascript" asp-append-version=@bApnd></script>
    <script src="~/js/EbControls/EbMsgBox.js" type="text/javascript" asp-append-version=@bApnd></script>
    <script src="~/js/EbControls/EbPopBox.js" type="text/javascript" asp-append-version=@bApnd></script>

    <script src="~/js/FormBuilder/EbCardRender.js" type="text/javascript" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/jquery.inputmask.bundle.js" asp-append-version=@bApnd></script>
    <script src="https://rawgit.com/KidSysco/jquery-ui-month-picker/v3.0.0/demo/MonthPicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
    <script type="text/javascript" src="~/js/EbFileViewer/EbFileViewerPlugin.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbFileViewer/viewer.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbControls/EbSimpleFileUploader.js"></script>
    <script type="text/javascript" src="~/js/yearpicker.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/CommonDataTable.js" asp-append-version=@bApnd></script>
    <script src="~/js/Eb_Basic_chart.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/splitWindow.js"></script>
    <script type="text/javascript" src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script type="text/javascript" src="~/js/FormBuilder/jquery.scrollTo.js" asp-append-version=@bApnd></script>
    @*nithin*@
    <script src="~/js/FormBuilder/MeetingPicker.js"></script>
</environment>

<script type="text/javascript" src='https://maps.google.com/maps/api/js?key=AIzaSyDcaoSVEMF_TRq6Lx-dkqh3Rvrv8_w-0tM&libraries=places'></script>
@*<script type="text/javascript" src="https://npmcdn.com/Chart.Zoom.js@0.3.0/Chart.Zoom.min.js"></script>*@




<script>
    var t1 = performance.now();
    console.log("bot link loading took " + (t1 - t0) + " milliseconds.");
</script>

<style>
    body {
        margin: 0;
        padding: 0px;
        background: var(--eb-bot-bg-color,#ffffff);
        font-family: var(--bot_fontfamily,Open Sans);
        font-size: var(--bot_fontsize,14px);
    }
</style>

@{
    EbToolbox _toolBox = new EbToolbox(ExpressBase.Common.Objects.BuilderType.BotForm);

    <script>
        @Html.Raw(_toolBox.AllMetas);
        @Html.Raw(_toolBox.EbObjectTypes);
    </script>
}

<script>
    @Html.Raw(ViewBag.ControlOperations);
        window.ebcontext = {
            sid: "@ViewBag.tid",
            user: null,
            //menu: {},
            //locations: {},
            //header: {},
            //setup:new Setup(),
            env:'@ViewBag.Env'
        }
</script>

<script>
    var solid = "@ViewBag.tid";
    var appid = "@ViewBag.appid";
    var settings = @Html.Raw(ViewBag.settings);
    var ServerEventUrl = "@ViewBag.ServerEventUrl";
    var chatBotObj = null;
    $(document).ready(function () {
        console.log("bot loaded");
        var html = document.getElementsByTagName('html')[0];
        html.style.setProperty("--botThemeColor", (settings.ThemeColor || "#055c9b"));

        if (settings.BotProp.AppFont) {
             $("head").append("<link href='https://fonts.googleapis.com/css?family=" + settings.BotProp.AppFont + "' rel='stylesheet' type='text/css'>");
        html.style.setProperty("--bot_fontfamily", settings.BotProp.AppFont);
        }
        if (settings.BotProp.AppFontSize) {
        html.style.setProperty("--bot_fontsize", settings.BotProp.AppFontSize+"px");
        }
        if (settings.BotProp.Bg_value) {
           let bgtyp=settings.BotProp.Bg_type ;
            if (bgtyp === 'bg_clr') {
              html.style.setProperty("--eb-bot-bg-color", settings.BotProp.Bg_value);
            }
            else if (bgtyp === 'bg_grdnt') {
              html.style.setProperty("--eb-bot-bg-color", settings.BotProp.Bg_value);
            } else if (bgtyp === 'bg_img') {
                html.style.setProperty("--eb-bot-bg-color", `url("/images/${settings.BotProp.Bg_value}.jpg") no-repeat center`);
            }
        }

        chatBotObj = new Eb_chatBot(solid, appid, settings, '@ViewBag.ServiceUrl', ServerEventUrl);

        $.get("https://ipinfo.io", function (response) {
            chatBotObj.userDtls.ip = response.ip;
            chatBotObj.userDtls.browser = getBrowserName();
        }, "jsonp");


        botUserLogin();
    });
    function botUserLogin() {
        chatBotObj.msgFromBot(chatBotObj.welcomeMessage);

        if (settings.Authoptions.Fblogin) {
            // This is called with the results from from FB.getLoginStatus().

             window.fbAsyncInit = function () {
                 console.log("bot"+ settings.Authoptions.FbAppVer);
                FB.init({
                    appId: settings.Authoptions.FbAppID,
                    //appId: ('@ViewBag.Env' === 'Development' ? '141908109794829' : ('@ViewBag.Env' === 'Staging' ? '1525758114176201' : '2202041803145524')),//'141908109794829',//,'1525758114176201',//
                    cookie: true,  // enable cookies to allow the server to access
                    // the session
                    xfbml: true,  // parse social plugins on this page
                    version:settings.Authoptions.FbAppVer
                    //version: ('@ViewBag.Env' === 'Development' ? 'v2.11' : ('@ViewBag.Env' === 'Staging' ? 'v2.8' : 'v3.0')) // use graph api version 2.8
                });

                FB.getLoginStatus(function (response) {
                    statusChangeCallback(response);
                });

            };

            // Load the SDK asynchronously
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));


            function statusChangeCallback(response) {
                console.log('statusChangeCallback');
                chatBotObj.FB = FB;
                //if (response.status === 'connected') {
                //    chatBotObj.FBLogined();
                //} else {
                //    chatBotObj.FBNotLogined();
                //}
            }

            // This function is called when someone finishes with the Login
            function checkLoginState() {
                FB.getLoginStatus(function (response) {
                    statusChangeCallback(response);
                });
            };



        }

        chatBotObj.AnonymousLoginOptions();



        }




</script>
