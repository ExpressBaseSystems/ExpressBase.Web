@{
    var bApnd = true;
    if (ViewBag.Env == "Development")
    {
        bApnd = false;
    }
}

@using ExpressBase.Objects;

<script>
    console.log(Date.now);
    var t0 = performance.now();
</script>


<link href="~/css/Bootstrap_JQuery/jquery-ui-1.12.1.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="~/css/Bootstrap_JQuery/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="~/css/slick-theme.css" />
@*BUNDLES*@
<environment exclude="Development">
    <link rel="stylesheet" href="~/css/Bundles/eb-botpage.bundle.css" asp-append-version=@bApnd />
</environment>
<link rel="stylesheet" type="text/css" href="~/css/EbChatBot.css" asp-append-version=@bApnd />
<link rel="stylesheet" href="~/css/EbControls/EbPhoneControl.css" asp-append-version=@bApnd> @*varghese*@

<environment include="Development">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap">
    @*<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick-theme.css" />*@
    <link rel="stylesheet" type="text/css" href="~/css/jquery.datetimepicker.css" asp-append-version=@bApnd>
    <link rel="stylesheet" type="text/css" href="~/css/bootstrap-select.min.css" asp-append-version=@bApnd />
    @*roby*@
    <link rel="stylesheet" type="text/css" href="~/css/Common/offline-theme-dark.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="~/css/datatables.min.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/DV/slick.css" />
    <link href="~/css/DV/MonthPicker.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="~/css/DV/jquery.rateyo.min.css">

    <link rel="stylesheet" type="text/css" href="~/css/Eb.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/EbControls/EbCardSet.css" asp-append-version=@bApnd />
    <link rel="stylesheet" href="~/css/yearpicker.css">
    <link rel="stylesheet" type="text/css" href="~/css/Eb_datatable.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/FormBuiderStyles.css" asp-append-version=@bApnd />
    @*<link rel="stylesheet" type="text/css" href="~/css/EbChatBot.css" asp-append-version=@bApnd />*@
    <link rel="stylesheet" type="text/css" href="~/css/EbCommonStyles/eb-style.css" asp-append-version=@bApnd />
    <link rel="stylesheet" type="text/css" href="~/css/DVBuilder.css" />
    <link rel="stylesheet" href="~/css/ChartStyle.css" asp-append-version=@bApnd>
    <link rel="stylesheet" type="text/css" href="~/css/DV/bootstrap-toggle.min.css">
    <link rel="stylesheet" type="text/css" href="~/css/EbFileViewer/viewer.css" asp-append-version=@bApnd>
    <link rel="stylesheet" href="~/css/MeetingPicker.css">
</environment>

@*<link rel="stylesheet" href="/resources/demos/style.css">*@

@*******************************JAVASCRIPT*****************************@

<script type="text/javascript" src="~/js/Bundles/bootsrap_jq.bundle.min.js" asp-append-version=@bApnd></script>


@*BUNDLES*@
<environment exclude  ="Development">
    <script type="text/javascript" src="~/js/Bundles/eb-botpage.bundle.js" asp-append-version=@bApnd></script>
    @*<script type="text/javascript" src="~/js/Bundles/eb-bot_minimal.bundle.js" defer asp-append-version=@bApnd></script>
        <script type="text/javascript" src="~/js/Bundles/eb-bot_secondary.bundle.js" defer asp-append-version=@bApnd></script>*@
</environment>

<environment include="Development">
    @*/eb-botpage.bundle*@

    <script type="text/javascript" src="~/js/FormBuilder/InitFormControls.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/ChatBot/Eb_chatBot.js" asp-append-version=@bApnd></script>

    @*amal*@
    <script type="text/javascript" src="~/js/EbServerEvents/eventsource.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbServerEvents/ss-utils.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbServerEvents/ServerEvents.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/Common/offline.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/eb_common.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/jquery.datetimepicker.min.js" asp-append-version=@bApnd></script>
    @*jith*@
    <script type="text/javascript" src="~/js/FormBuilder/bootstrap-confirmation.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/jQuery Mask Plugin v1.14.9.js"></script>


    <script src="~/js/EbControls/EbProgressBar.js" type="text/javascript" asp-append-version=@bApnd></script>
    <script src="~/js/EbControls/EbMsgBox.js" type="text/javascript" asp-append-version=@bApnd></script>
    <script src="~/js/EbControls/EbPopBox.js" type="text/javascript" asp-append-version=@bApnd></script>


    <script type="text/javascript" src="~/js/FormBuilder/bootstrap-toggle.min.js"></script>
    <script type="text/javascript" src="~/js/FormBuilder/jquery.scrollTo.js" asp-append-version=@bApnd></script>
</environment>

<environment include="Development">
    @*eb-bot_minimal.bundle*@
    <script type="text/javascript" src="~/js/moment.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/vue-select.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/vue@2.1.10.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/Eb_UtilityFuncions.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbControls/EbPowerSelect.js" asp-append-version=@bApnd></script>

    <script type="text/javascript" src="~/js/FormBuilder/EbSurveyRender.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/FormBuilder/Bootstrap-select.v1.12.2.js"></script>
    <script type="text/javascript" src="~/js/slick.min.js"></script>
    <script type="text/javascript" src="~/js/FormBuilder/locationpicker.jquery.min.js" asp-append-version=@bApnd></script>

    <script src="~/js/FormBuilder/EbCardRender.js" type="text/javascript" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/jquery.inputmask.bundle.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/FormBuilder/MonthPicker.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/FormBuilder/jquery.rateyo.min.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbControls/EbSimpleFileUploader.js"></script>
    <script type="text/javascript" src="~/js/yearpicker.js" asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/splitWindow.js"></script>

    <script src="~/js/FormBuilder/MeetingPicker.js"></script>

</environment>

<environment include="Development">
    @*eb-bot_secondary.bundle*@
    <script type="text/javascript" src="~/js/FormBuilder/vue.js" defer asp-append-version=@bApnd></script>

    <script type="text/javascript" src="~/js/datatables.min.js" defer asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbDataTable.js" defer asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/Eb_Basic_DataTable.js" defer asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/CommonDataTable.js" defer asp-append-version=@bApnd></script>


    <script type="text/javascript" src="~/js/Chart.js" defer asp-append-version=@bApnd></script>
    <script src="~/js/Eb_Basic_chart.js" defer asp-append-version=@bApnd></script>


    <script type="text/javascript" src="~/js/EbFileViewer/EbFileViewerPlugin.js" defer asp-append-version=@bApnd></script>
    <script type="text/javascript" src="~/js/EbFileViewer/viewer.js" defer asp-append-version=@bApnd></script>


    <script src="~/js/EbControls/EbPhoneControl.js" type="text/javascript" defer asp-append-version=@bApnd></script> @*varghese*@
</environment>
<script type="text/javascript" src='https://maps.google.com/maps/api/js?key=AIzaSyDcaoSVEMF_TRq6Lx-dkqh3Rvrv8_w-0tM&libraries=places' defer></script>
@*<script type="text/javascript" src="https://npmcdn.com/Chart.Zoom.js@0.3.0/Chart.Zoom.min.js"></script>*@


<script>
    var t1 = performance.now();
    console.log("bot link loading took " + (t1 - t0) + " milliseconds.");
</script>

<style>
    body {
        margin: 0;
        padding: 0px;
        background: var(--eb-bot-bg-color,#ffffff);
        font-family: var(--bot_fontfamily,Open Sans);
        font-size: var(--bot_fontsize,14px);
    }
</style>

@{
    EbToolbox _toolBox = new EbToolbox(ExpressBase.Common.Objects.BuilderType.BotForm);

    <script>
        @Html.Raw(_toolBox.AllMetas);
        @Html.Raw(_toolBox.EbObjectTypes);
    </script>
}

<script>
    @Html.Raw(ViewBag.ControlOperations);
        window.ebcontext = {
            sid: "@ViewBag.tid",
            user: null,
            //menu: {},
            //locations: {},
            //header: {},
            //setup:new Setup(),
            env:'@ViewBag.Env'
        }
</script>

<script>
    var solid = "@ViewBag.tid";
    var appid = "@ViewBag.appid";
    var settings = @Html.Raw(ViewBag.settings);
    var ServerEventUrl = "@ViewBag.ServerEventUrl";
    var chatBotObj = null;
    $(document).ready(function () {
        console.log("bot loaded");
        var html = document.getElementsByTagName('html')[0];
        html.style.setProperty("--botThemeColor", (settings.ThemeColor || "#055c9b"));
        if (settings.BotProp.AppFont) {
             $("head").append("<link href='https://fonts.googleapis.com/css?family=" + settings.BotProp.AppFont + "' rel='stylesheet' type='text/css'>");
        html.style.setProperty("--bot_fontfamily", settings.BotProp.AppFont);
        }
        if (settings.BotProp.AppFontSize) {
        html.style.setProperty("--bot_fontsize", settings.BotProp.AppFontSize+"px");
        }
        if (settings.BotProp.Bg_value) {
            let bgtyp = settings.BotProp.Bg_type;
            if (bgtyp === 'bg_clr') {
              html.style.setProperty("--eb-bot-bg-color", settings.BotProp.Bg_value);
            }
            else if (bgtyp === 'bg_grdnt') {
              html.style.setProperty("--eb-bot-bg-color", settings.BotProp.Bg_value);
            } else if (bgtyp === 'bg_img') {
               // html.style.setProperty("--eb-bot-bg-color", `url("/images/${settings.BotProp.Bg_value}.jpg") no-repeat center`);
                html.style.setProperty("--eb-bot-bg-color", `url("/botExt/images/original/${settings.BotProp.Bg_value}.jpg") no-repeat center`);
            }
        }
        chatBotObj = new Eb_chatBot(solid, appid, settings, '@ViewBag.cid','@ViewBag.ServiceUrl', ServerEventUrl);

        //$.get("https://ipinfo.io", function (response) {
        //    chatBotObj.userDtls.ip = response.ip;
        //    chatBotObj.userDtls.browser = getBrowserName();
        //}, "jsonp");
        if ('@ViewBag.Env' != 'Development') {
             (function include_Script() {
                var s = document.createElement('script');
                s.src = '/js/Bundles/eb-bot_minimal.bundle.js';
                s.type = 'text/javascript';
                s.async = false;
                document.head.appendChild(s);
                console.log("loaded - eb-bot_minimal.bundle.js");

                var s1 = document.createElement('script');
                s1.src = '/js/datatables.min.js';
                s1.type = 'text/javascript';
                s1.async = false;
                document.head.appendChild(s1);
                console.log("loaded - datatables.min.js");

                var s2 = document.createElement('script');
                s2.src = '/js/Bundles/eb-bot_secondary.bundle.js';
                s2.type = 'text/javascript';
                s2.async = false;
                document.head.appendChild(s2);
                console.log("loaded - eb-bot_secondary.bundle.js");
            })();

        }

    });




</script>

